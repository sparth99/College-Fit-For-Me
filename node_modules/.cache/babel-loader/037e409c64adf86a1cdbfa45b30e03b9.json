{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n\n  return target;\n};\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactDom = require('react-dom');\n\nvar _reactDom2 = _interopRequireDefault(_reactDom);\n\nvar _createReactClass = require('create-react-class');\n\nvar _createReactClass2 = _interopRequireDefault(_createReactClass);\n\nvar _Chart = require('./Chart');\n\nvar _Chart2 = _interopRequireDefault(_Chart);\n\nvar _Axis = require('./Axis');\n\nvar _Axis2 = _interopRequireDefault(_Axis);\n\nvar _HeightWidthMixin = require('./HeightWidthMixin');\n\nvar _HeightWidthMixin2 = _interopRequireDefault(_HeightWidthMixin);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n} // Adapted for React from https://github.com/mbostock/d3/blob/master/src/svg/brush.js\n// TODO: Add D3 License\n\n\nvar _d3SvgBrushCursor = {\n  n: 'ns-resize',\n  e: 'ew-resize',\n  s: 'ns-resize',\n  w: 'ew-resize',\n  nw: 'nwse-resize',\n  ne: 'nesw-resize',\n  se: 'nwse-resize',\n  sw: 'nesw-resize'\n};\nvar _d3SvgBrushResizes = [['n', 'e', 's', 'w', 'nw', 'ne', 'se', 'sw'], ['e', 'w'], ['n', 's'], []]; // TODO: add y axis support\n\nvar Brush = (0, _createReactClass2.default)({\n  displayName: 'Brush',\n  mixins: [_HeightWidthMixin2.default],\n  getInitialState: function getInitialState() {\n    return {\n      resizers: _d3SvgBrushResizes[0],\n      xExtent: [0, 0],\n      yExtent: [0, 0],\n      xExtentDomain: undefined,\n      yExtentDomain: undefined\n    };\n  },\n  getDefaultProps: function getDefaultProps() {\n    return {\n      xScale: null,\n      yScale: null\n    };\n  },\n  componentWillMount: function componentWillMount() {\n    this._extent(this.props.extent);\n\n    this.setState({\n      resizers: _d3SvgBrushResizes[!this.props.xScale << 1 | !this.props.yScale]\n    });\n  },\n  componentWillReceiveProps: function componentWillReceiveProps(nextProps) {\n    // when <Brush/> is used inside a component\n    // we should not set the extent prop on every redraw of the parent, because it will\n    // stop us from actually setting the extent with the brush.\n    if (nextProps.xScale !== this.props.xScale) {\n      this._extent(nextProps.extent, nextProps.xScale);\n\n      this.setState({\n        resizers: _d3SvgBrushResizes[!this.props.xScale << 1 | !this.props.yScale]\n      });\n    }\n  },\n  render: function render() {\n    var _this = this; // TODO: remove this.state this.props\n\n\n    var xRange = this.props.xScale ? this._d3ScaleRange(this.props.xScale) : null;\n    var yRange = this.props.yScale ? this._d3ScaleRange(this.props.yScale) : null;\n\n    var background = _react2.default.createElement('rect', {\n      className: 'background',\n      style: {\n        visibility: 'visible',\n        cursor: 'crosshair'\n      },\n      x: xRange ? xRange[0] : '',\n      width: xRange ? xRange[1] - xRange[0] : '',\n      y: yRange ? yRange[0] : '',\n      height: yRange ? yRange[1] - yRange[0] : this._innerHeight,\n      onMouseDown: this._onMouseDownBackground\n    }); // TODO: it seems like actually we can have both x and y scales at the same time. need to find example.\n\n\n    var extent = void 0;\n\n    if (this.props.xScale) {\n      extent = _react2.default.createElement('rect', {\n        className: 'extent',\n        style: {\n          cursor: 'move'\n        },\n        x: this.state.xExtent[0],\n        width: this.state.xExtent[1] - this.state.xExtent[0],\n        height: this._innerHeight,\n        onMouseDown: this._onMouseDownExtent\n      });\n    }\n\n    var resizers = this.state.resizers.map(function (e) {\n      return _react2.default.createElement('g', {\n        key: e,\n        className: 'resize ' + e,\n        style: {\n          cursor: _d3SvgBrushCursor[e]\n        },\n        transform: 'translate(' + _this.state.xExtent[+/e$/.test(e)] + ', ' + _this.state.yExtent[+/^s/.test(e)] + ')',\n        onMouseDown: function onMouseDown(event) {\n          _this._onMouseDownResizer(event, e);\n        }\n      }, _react2.default.createElement('rect', {\n        x: /[ew]$/.test(e) ? -3 : null,\n        y: /^[ns]/.test(e) ? -3 : null,\n        width: '6',\n        height: _this._innerHeight,\n        style: {\n          visibility: 'hidden',\n          display: _this._empty() ? 'none' : null\n        }\n      }));\n    });\n    var _props = this.props,\n        height = _props.height,\n        width = _props.width,\n        margin = _props.margin,\n        viewBox = _props.viewBox,\n        preserveAspectRatio = _props.preserveAspectRatio;\n    return _react2.default.createElement('div', null, _react2.default.createElement(_Chart2.default, {\n      height: height,\n      width: width,\n      margin: margin,\n      viewBox: viewBox,\n      preserveAspectRatio: preserveAspectRatio\n    }, _react2.default.createElement('g', {\n      style: {\n        pointerEvents: 'all'\n      },\n      onMouseUp: this._onMouseUp,\n      onMouseMove: this._onMouseMove\n    }, background, extent, resizers), _react2.default.createElement(_Axis2.default, _extends({\n      className: 'x axis',\n      orientation: 'bottom',\n      scale: this.props.xScale,\n      height: this._innerHeight,\n      width: this._innerWidth\n    }, this.props.xAxis)), this.props.children));\n  },\n  // TODO: Code duplicated in TooltipMixin.jsx, move outside.\n  _getMousePosition: function _getMousePosition(e) {\n    var svg = _reactDom2.default.findDOMNode(this).getElementsByTagName('svg')[0];\n\n    var position = void 0;\n\n    if (svg.createSVGPoint) {\n      var point = svg.createSVGPoint();\n      point.x = e.clientX;\n      point.y = e.clientY;\n      point = point.matrixTransform(svg.getScreenCTM().inverse());\n      position = [point.x - this.props.margin.left, point.y - this.props.margin.top];\n    } else {\n      var rect = svg.getBoundingClientRect();\n      position = [e.clientX - rect.left - svg.clientLeft - this.props.margin.left, e.clientY - rect.top - svg.clientTop - this.props.margin.left];\n    }\n\n    return position;\n  },\n  _onMouseDownBackground: function _onMouseDownBackground(e) {\n    e.preventDefault();\n\n    var range = this._d3ScaleRange(this.props.xScale);\n\n    var point = this._getMousePosition(e);\n\n    var size = this.state.xExtent[1] - this.state.xExtent[0];\n    range[1] -= size;\n    var min = Math.max(range[0], Math.min(range[1], point[0]));\n    this.setState({\n      xExtent: [min, min + size]\n    });\n  },\n  // TODO: use constants instead of strings\n  _onMouseDownExtent: function _onMouseDownExtent(e) {\n    e.preventDefault();\n    this._mouseMode = 'drag';\n\n    var point = this._getMousePosition(e);\n\n    var distanceFromBorder = point[0] - this.state.xExtent[0];\n    this._startPosition = distanceFromBorder;\n  },\n  _onMouseDownResizer: function _onMouseDownResizer(e, dir) {\n    e.preventDefault();\n    this._mouseMode = 'resize';\n    this._resizeDir = dir;\n  },\n  _onDrag: function _onDrag(e) {\n    var range = this._d3ScaleRange(this.props.xScale);\n\n    var point = this._getMousePosition(e);\n\n    var size = this.state.xExtent[1] - this.state.xExtent[0];\n    range[1] -= size;\n    var min = Math.max(range[0], Math.min(range[1], point[0] - this._startPosition));\n    this.setState({\n      xExtent: [min, min + size],\n      xExtentDomain: null\n    });\n  },\n  _onResize: function _onResize(e) {\n    var range = this._d3ScaleRange(this.props.xScale);\n\n    var point = this._getMousePosition(e); // Don't let the extent go outside of its limits\n    // TODO: support clamp argument of D3\n\n\n    var min = Math.max(range[0], Math.min(range[1], point[0]));\n\n    if (this._resizeDir == 'w') {\n      if (min > this.state.xExtent[1]) {\n        this.setState({\n          xExtent: [this.state.xExtent[1], min],\n          xExtentDomain: null\n        });\n        this._resizeDir = 'e';\n      } else {\n        this.setState({\n          xExtent: [min, this.state.xExtent[1]],\n          xExtentDomain: null\n        });\n      }\n    } else if (this._resizeDir == 'e') {\n      if (min < this.state.xExtent[0]) {\n        this.setState({\n          xExtent: [min, this.state.xExtent[0]],\n          xExtentDomain: null\n        });\n        this._resizeDir = 'w';\n      } else {\n        this.setState({\n          xExtent: [this.state.xExtent[0], min],\n          xExtentDomain: null\n        });\n      }\n    }\n  },\n  _onMouseMove: function _onMouseMove(e) {\n    e.preventDefault();\n\n    if (this._mouseMode == 'resize') {\n      this._onResize(e);\n    } else if (this._mouseMode == 'drag') {\n      this._onDrag(e);\n    }\n  },\n  _onMouseUp: function _onMouseUp(e) {\n    e.preventDefault();\n    this._mouseMode = null;\n    this.props.onChange(this._extent());\n  },\n  _extent: function _extent(z, xScale) {\n    var x = xScale || this.props.xScale;\n    var y = this.props.yScale;\n    var _state = this.state,\n        xExtent = _state.xExtent,\n        yExtent = _state.yExtent,\n        xExtentDomain = _state.xExtentDomain,\n        yExtentDomain = _state.yExtentDomain;\n    var x0 = void 0,\n        x1 = void 0,\n        y0 = void 0,\n        y1 = void 0,\n        t = void 0; // Invert the pixel extent to data-space.\n\n    if (!arguments.length) {\n      if (x) {\n        if (xExtentDomain) {\n          x0 = xExtentDomain[0], x1 = xExtentDomain[1];\n        } else {\n          x0 = xExtent[0], x1 = xExtent[1];\n          if (x.invert) x0 = x.invert(x0), x1 = x.invert(x1);\n          if (x1 < x0) t = x0, x0 = x1, x1 = t;\n        }\n      }\n\n      if (y) {\n        if (yExtentDomain) {\n          y0 = yExtentDomain[0], y1 = yExtentDomain[1];\n        } else {\n          y0 = yExtent[0], y1 = yExtent[1];\n          if (y.invert) y0 = y.invert(y0), y1 = y.invert(y1);\n          if (y1 < y0) t = y0, y0 = y1, y1 = t;\n        }\n      }\n\n      return x && y ? [[x0, y0], [x1, y1]] : x ? [x0, x1] : y && [y0, y1];\n    } // Scale the data-space extent to pixels.\n\n\n    if (x) {\n      x0 = z[0], x1 = z[1];\n      if (y) x0 = x0[0], x1 = x1[0];\n      xExtentDomain = [x0, x1];\n      if (x.invert) x0 = x(x0), x1 = x(x1);\n      if (x1 < x0) t = x0, x0 = x1, x1 = t;\n      if (x0 != xExtent[0] || x1 != xExtent[1]) xExtent = [x0, x1]; // copy-on-write\n    }\n\n    if (y) {\n      y0 = z[0], y1 = z[1];\n      if (x) y0 = y0[1], y1 = y1[1];\n      yExtentDomain = [y0, y1];\n      if (y.invert) y0 = y(y0), y1 = y(y1);\n      if (y1 < y0) t = y0, y0 = y1, y1 = t;\n      if (y0 != yExtent[0] || y1 != yExtent[1]) yExtent = [y0, y1]; // copy-on-write\n    }\n\n    this.setState({\n      xExtent: xExtent,\n      yExtent: yExtent,\n      xExtentDomain: xExtentDomain,\n      yExtentDomain: yExtentDomain\n    });\n  },\n  _empty: function _empty() {\n    return !!this.props.xScale && this.state.xExtent[0] == this.state.xExtent[1] || !!this.props.yScale && this.state.yExtent[0] == this.state.yExtent[1];\n  },\n  // TODO: Code duplicated in Axis.jsx, move outside.\n  _d3ScaleExtent: function _d3ScaleExtent(domain) {\n    var start = domain[0];\n    var stop = domain[domain.length - 1];\n    return start < stop ? [start, stop] : [stop, start];\n  },\n  _d3ScaleRange: function _d3ScaleRange(scale) {\n    return scale.rangeExtent ? scale.rangeExtent() : this._d3ScaleExtent(scale.range());\n  }\n});\nexports.default = Brush;","map":{"version":3,"sources":["/Users/Parth/web-project/node_modules/react-d3-components/lib/Brush.js"],"names":["Object","defineProperty","exports","value","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","_react","require","_react2","_interopRequireDefault","_reactDom","_reactDom2","_createReactClass","_createReactClass2","_Chart","_Chart2","_Axis","_Axis2","_HeightWidthMixin","_HeightWidthMixin2","obj","__esModule","default","_d3SvgBrushCursor","n","e","s","w","nw","ne","se","sw","_d3SvgBrushResizes","Brush","displayName","mixins","getInitialState","resizers","xExtent","yExtent","xExtentDomain","undefined","yExtentDomain","getDefaultProps","xScale","yScale","componentWillMount","_extent","props","extent","setState","componentWillReceiveProps","nextProps","render","_this","xRange","_d3ScaleRange","yRange","background","createElement","className","style","visibility","cursor","x","width","y","height","_innerHeight","onMouseDown","_onMouseDownBackground","state","_onMouseDownExtent","map","transform","test","event","_onMouseDownResizer","display","_empty","_props","margin","viewBox","preserveAspectRatio","pointerEvents","onMouseUp","_onMouseUp","onMouseMove","_onMouseMove","orientation","scale","_innerWidth","xAxis","children","_getMousePosition","svg","findDOMNode","getElementsByTagName","position","createSVGPoint","point","clientX","clientY","matrixTransform","getScreenCTM","inverse","left","top","rect","getBoundingClientRect","clientLeft","clientTop","preventDefault","range","size","min","Math","max","_mouseMode","distanceFromBorder","_startPosition","dir","_resizeDir","_onDrag","_onResize","onChange","z","_state","x0","x1","y0","y1","t","invert","_d3ScaleExtent","domain","start","stop","rangeExtent"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactDom = require('react-dom');\n\nvar _reactDom2 = _interopRequireDefault(_reactDom);\n\nvar _createReactClass = require('create-react-class');\n\nvar _createReactClass2 = _interopRequireDefault(_createReactClass);\n\nvar _Chart = require('./Chart');\n\nvar _Chart2 = _interopRequireDefault(_Chart);\n\nvar _Axis = require('./Axis');\n\nvar _Axis2 = _interopRequireDefault(_Axis);\n\nvar _HeightWidthMixin = require('./HeightWidthMixin');\n\nvar _HeightWidthMixin2 = _interopRequireDefault(_HeightWidthMixin);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// Adapted for React from https://github.com/mbostock/d3/blob/master/src/svg/brush.js\n// TODO: Add D3 License\nvar _d3SvgBrushCursor = {\n    n: 'ns-resize',\n    e: 'ew-resize',\n    s: 'ns-resize',\n    w: 'ew-resize',\n    nw: 'nwse-resize',\n    ne: 'nesw-resize',\n    se: 'nwse-resize',\n    sw: 'nesw-resize'\n};\n\nvar _d3SvgBrushResizes = [['n', 'e', 's', 'w', 'nw', 'ne', 'se', 'sw'], ['e', 'w'], ['n', 's'], []];\n\n// TODO: add y axis support\nvar Brush = (0, _createReactClass2.default)({\n    displayName: 'Brush',\n\n    mixins: [_HeightWidthMixin2.default],\n\n    getInitialState: function getInitialState() {\n        return {\n            resizers: _d3SvgBrushResizes[0],\n            xExtent: [0, 0],\n            yExtent: [0, 0],\n            xExtentDomain: undefined,\n            yExtentDomain: undefined\n        };\n    },\n    getDefaultProps: function getDefaultProps() {\n        return {\n            xScale: null,\n            yScale: null\n        };\n    },\n    componentWillMount: function componentWillMount() {\n        this._extent(this.props.extent);\n\n        this.setState({\n            resizers: _d3SvgBrushResizes[!this.props.xScale << 1 | !this.props.yScale]\n        });\n    },\n    componentWillReceiveProps: function componentWillReceiveProps(nextProps) {\n        // when <Brush/> is used inside a component\n        // we should not set the extent prop on every redraw of the parent, because it will\n        // stop us from actually setting the extent with the brush.\n        if (nextProps.xScale !== this.props.xScale) {\n            this._extent(nextProps.extent, nextProps.xScale);\n            this.setState({\n                resizers: _d3SvgBrushResizes[!this.props.xScale << 1 | !this.props.yScale]\n            });\n        }\n    },\n    render: function render() {\n        var _this = this;\n\n        // TODO: remove this.state this.props\n        var xRange = this.props.xScale ? this._d3ScaleRange(this.props.xScale) : null;\n        var yRange = this.props.yScale ? this._d3ScaleRange(this.props.yScale) : null;\n\n        var background = _react2.default.createElement('rect', {\n            className: 'background',\n            style: { visibility: 'visible', cursor: 'crosshair' },\n            x: xRange ? xRange[0] : '',\n            width: xRange ? xRange[1] - xRange[0] : '',\n            y: yRange ? yRange[0] : '',\n            height: yRange ? yRange[1] - yRange[0] : this._innerHeight,\n            onMouseDown: this._onMouseDownBackground\n        });\n\n        // TODO: it seems like actually we can have both x and y scales at the same time. need to find example.\n\n        var extent = void 0;\n        if (this.props.xScale) {\n            extent = _react2.default.createElement('rect', {\n                className: 'extent',\n                style: { cursor: 'move' },\n                x: this.state.xExtent[0],\n                width: this.state.xExtent[1] - this.state.xExtent[0],\n                height: this._innerHeight,\n                onMouseDown: this._onMouseDownExtent\n            });\n        }\n\n        var resizers = this.state.resizers.map(function (e) {\n            return _react2.default.createElement(\n                'g',\n                {\n                    key: e,\n                    className: 'resize ' + e,\n                    style: { cursor: _d3SvgBrushCursor[e] },\n                    transform: 'translate(' + _this.state.xExtent[+/e$/.test(e)] + ', ' + _this.state.yExtent[+/^s/.test(e)] + ')',\n                    onMouseDown: function onMouseDown(event) {\n                        _this._onMouseDownResizer(event, e);\n                    }\n                },\n                _react2.default.createElement('rect', {\n                    x: /[ew]$/.test(e) ? -3 : null,\n                    y: /^[ns]/.test(e) ? -3 : null,\n                    width: '6',\n                    height: _this._innerHeight,\n                    style: { visibility: 'hidden', display: _this._empty() ? 'none' : null }\n                })\n            );\n        });\n\n        var _props = this.props,\n            height = _props.height,\n            width = _props.width,\n            margin = _props.margin,\n            viewBox = _props.viewBox,\n            preserveAspectRatio = _props.preserveAspectRatio;\n\n\n        return _react2.default.createElement(\n            'div',\n            null,\n            _react2.default.createElement(\n                _Chart2.default,\n                { height: height, width: width, margin: margin, viewBox: viewBox, preserveAspectRatio: preserveAspectRatio },\n                _react2.default.createElement(\n                    'g',\n                    {\n                        style: { pointerEvents: 'all' },\n                        onMouseUp: this._onMouseUp,\n                        onMouseMove: this._onMouseMove\n                    },\n                    background,\n                    extent,\n                    resizers\n                ),\n                _react2.default.createElement(_Axis2.default, _extends({\n                    className: 'x axis',\n                    orientation: 'bottom',\n                    scale: this.props.xScale,\n                    height: this._innerHeight,\n                    width: this._innerWidth\n                }, this.props.xAxis)),\n                this.props.children\n            )\n        );\n    },\n\n\n    // TODO: Code duplicated in TooltipMixin.jsx, move outside.\n    _getMousePosition: function _getMousePosition(e) {\n        var svg = _reactDom2.default.findDOMNode(this).getElementsByTagName('svg')[0];\n        var position = void 0;\n        if (svg.createSVGPoint) {\n            var point = svg.createSVGPoint();\n            point.x = e.clientX;\n            point.y = e.clientY;\n            point = point.matrixTransform(svg.getScreenCTM().inverse());\n            position = [point.x - this.props.margin.left, point.y - this.props.margin.top];\n        } else {\n            var rect = svg.getBoundingClientRect();\n            position = [e.clientX - rect.left - svg.clientLeft - this.props.margin.left, e.clientY - rect.top - svg.clientTop - this.props.margin.left];\n        }\n\n        return position;\n    },\n    _onMouseDownBackground: function _onMouseDownBackground(e) {\n        e.preventDefault();\n        var range = this._d3ScaleRange(this.props.xScale);\n        var point = this._getMousePosition(e);\n\n        var size = this.state.xExtent[1] - this.state.xExtent[0];\n\n        range[1] -= size;\n\n        var min = Math.max(range[0], Math.min(range[1], point[0]));\n        this.setState({ xExtent: [min, min + size] });\n    },\n\n\n    // TODO: use constants instead of strings\n    _onMouseDownExtent: function _onMouseDownExtent(e) {\n        e.preventDefault();\n        this._mouseMode = 'drag';\n\n        var point = this._getMousePosition(e);\n        var distanceFromBorder = point[0] - this.state.xExtent[0];\n\n        this._startPosition = distanceFromBorder;\n    },\n    _onMouseDownResizer: function _onMouseDownResizer(e, dir) {\n        e.preventDefault();\n        this._mouseMode = 'resize';\n        this._resizeDir = dir;\n    },\n    _onDrag: function _onDrag(e) {\n        var range = this._d3ScaleRange(this.props.xScale);\n        var point = this._getMousePosition(e);\n\n        var size = this.state.xExtent[1] - this.state.xExtent[0];\n\n        range[1] -= size;\n\n        var min = Math.max(range[0], Math.min(range[1], point[0] - this._startPosition));\n\n        this.setState({ xExtent: [min, min + size], xExtentDomain: null });\n    },\n    _onResize: function _onResize(e) {\n        var range = this._d3ScaleRange(this.props.xScale);\n        var point = this._getMousePosition(e);\n        // Don't let the extent go outside of its limits\n        // TODO: support clamp argument of D3\n        var min = Math.max(range[0], Math.min(range[1], point[0]));\n\n        if (this._resizeDir == 'w') {\n            if (min > this.state.xExtent[1]) {\n                this.setState({ xExtent: [this.state.xExtent[1], min], xExtentDomain: null });\n                this._resizeDir = 'e';\n            } else {\n                this.setState({ xExtent: [min, this.state.xExtent[1]], xExtentDomain: null });\n            }\n        } else if (this._resizeDir == 'e') {\n            if (min < this.state.xExtent[0]) {\n                this.setState({ xExtent: [min, this.state.xExtent[0]], xExtentDomain: null });\n                this._resizeDir = 'w';\n            } else {\n                this.setState({ xExtent: [this.state.xExtent[0], min], xExtentDomain: null });\n            }\n        }\n    },\n    _onMouseMove: function _onMouseMove(e) {\n        e.preventDefault();\n\n        if (this._mouseMode == 'resize') {\n            this._onResize(e);\n        } else if (this._mouseMode == 'drag') {\n            this._onDrag(e);\n        }\n    },\n    _onMouseUp: function _onMouseUp(e) {\n        e.preventDefault();\n\n        this._mouseMode = null;\n\n        this.props.onChange(this._extent());\n    },\n    _extent: function _extent(z, xScale) {\n        var x = xScale || this.props.xScale;\n        var y = this.props.yScale;\n\n        var _state = this.state,\n            xExtent = _state.xExtent,\n            yExtent = _state.yExtent,\n            xExtentDomain = _state.xExtentDomain,\n            yExtentDomain = _state.yExtentDomain;\n\n\n        var x0 = void 0,\n            x1 = void 0,\n            y0 = void 0,\n            y1 = void 0,\n            t = void 0;\n\n        // Invert the pixel extent to data-space.\n        if (!arguments.length) {\n            if (x) {\n                if (xExtentDomain) {\n                    x0 = xExtentDomain[0], x1 = xExtentDomain[1];\n                } else {\n                    x0 = xExtent[0], x1 = xExtent[1];\n                    if (x.invert) x0 = x.invert(x0), x1 = x.invert(x1);\n                    if (x1 < x0) t = x0, x0 = x1, x1 = t;\n                }\n            }\n            if (y) {\n                if (yExtentDomain) {\n                    y0 = yExtentDomain[0], y1 = yExtentDomain[1];\n                } else {\n                    y0 = yExtent[0], y1 = yExtent[1];\n                    if (y.invert) y0 = y.invert(y0), y1 = y.invert(y1);\n                    if (y1 < y0) t = y0, y0 = y1, y1 = t;\n                }\n            }\n            return x && y ? [[x0, y0], [x1, y1]] : x ? [x0, x1] : y && [y0, y1];\n        }\n\n        // Scale the data-space extent to pixels.\n        if (x) {\n            x0 = z[0], x1 = z[1];\n            if (y) x0 = x0[0], x1 = x1[0];\n            xExtentDomain = [x0, x1];\n            if (x.invert) x0 = x(x0), x1 = x(x1);\n            if (x1 < x0) t = x0, x0 = x1, x1 = t;\n            if (x0 != xExtent[0] || x1 != xExtent[1]) xExtent = [x0, x1]; // copy-on-write\n        }\n        if (y) {\n            y0 = z[0], y1 = z[1];\n            if (x) y0 = y0[1], y1 = y1[1];\n            yExtentDomain = [y0, y1];\n            if (y.invert) y0 = y(y0), y1 = y(y1);\n            if (y1 < y0) t = y0, y0 = y1, y1 = t;\n            if (y0 != yExtent[0] || y1 != yExtent[1]) yExtent = [y0, y1]; // copy-on-write\n        }\n\n        this.setState({ xExtent: xExtent, yExtent: yExtent, xExtentDomain: xExtentDomain, yExtentDomain: yExtentDomain });\n    },\n    _empty: function _empty() {\n        return !!this.props.xScale && this.state.xExtent[0] == this.state.xExtent[1] || !!this.props.yScale && this.state.yExtent[0] == this.state.yExtent[1];\n    },\n\n\n    // TODO: Code duplicated in Axis.jsx, move outside.\n    _d3ScaleExtent: function _d3ScaleExtent(domain) {\n        var start = domain[0];\n        var stop = domain[domain.length - 1];\n        return start < stop ? [start, stop] : [stop, start];\n    },\n    _d3ScaleRange: function _d3ScaleRange(scale) {\n        return scale.rangeExtent ? scale.rangeExtent() : this._d3ScaleExtent(scale.range());\n    }\n});\n\nexports.default = Brush;"]},"metadata":{},"sourceType":"script"}